const {makeEmitter, supportedTests} = require('@applitools/sdk-shared/coverage-tests/generic')

function makeTemplate(test) {
  const tags = []
  if (test.meta.features) tags.push(...test.meta.features.map(feature => `@${feature}`))
  if (test.meta.native) tags.push('@native')
  if (test.meta.mobile) tags.push('@mobile')
  if (test.meta.browser) {
    tags.push(`@${test.meta.browser.replace(/-[\d.]+$/, '')}`)
  }

  return `// Generated by sdk-test-kit
${test.hooks.deps.join('\n')}
${test.hooks.vars.join('\n')}
describe('${test.name}', () => {
  before(async function(driver, done) {
    ${test.hooks.beforeEach.join('\n  ')}
    done()
  })
  after(async function(driver, done) {
    ${test.hooks.afterEach.join('\n  ')}
    done()
  })
  it${test.disabled ? '.skip' : ''}('${test.name}${
    tags.length > 0 ? ` (${tags.join(' ')})` : ''
  }', async function(driver) {
    ${test.commands.join('\n    ')}
  })
})`
}

module.exports = {
  name: 'eyes-protractor',
  out: './test/coverage/generic',
  ext: '.spec.js',
  initialize: makeEmitter,
  testFrameworkTemplate: makeTemplate,
  supportedTests,
  testsUrl: 'https://raw.githubusercontent.com/applitools/sdk.coverage.tests/env-and-meta/tests.js',
}
