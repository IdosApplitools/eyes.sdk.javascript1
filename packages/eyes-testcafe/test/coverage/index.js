const {makeEmitter, supportedTests} = require('@applitools/sdk-shared/coverage-tests/generic')

function createTestCafeTestString(test) {
  const tags = []
  if (test.meta.features) tags.push(...test.meta.features.map(feature => `@${feature}`))
  if (test.meta.native) tags.push('@native')
  if (test.meta.mobile) tags.push('@mobile')
  if (test.meta.browser) {
    tags.push(`@${test.meta.browser.replace(/-[\d.]+$/, '')}`)
  }

  return `// Generated by sdk-test-kit
${test.hooks.deps.join('\n')}
${test.hooks.vars.join('\n')}
fixture\`${test.name}\`
.beforeEach(async () => {
  ${test.hooks.beforeEach.join('\n  ')}
})
.after(async () => {
  ${test.hooks.afterEach.join('\n  ')}
})
test${test.disabled ? '.skip' : ''}('${test.name}${
    tags.length > 0 ? ` (${tags.join(' ')})` : ''
  }', async driver => {
  ${test.commands.join('\n  ')}
})`
}

module.exports = {
  name: 'eyes-testcafe',
  out: './test/coverage/generic',
  ext: '.spec.js',
  initialize: makeEmitter,
  testFrameworkTemplate: createTestCafeTestString,
  supportedTests,
  testsUrl: 'https://raw.githubusercontent.com/applitools/sdk.coverage.tests/env-and-meta/tests.js',
}
