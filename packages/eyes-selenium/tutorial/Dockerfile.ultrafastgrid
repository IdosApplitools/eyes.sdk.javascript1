FROM tutorial_nodejs:latest

RUN cd home/project \
    && git clone https://github.com/applitools/tutorial-selenium-javascript-ultrafastgrid.git \
    && cd tutorial-selenium-javascript-ultrafastgrid \
    && find ./test -type f -exec sed -i "s/'APPLITOOLS_API_KEY'/process.env.APPLITOOLS_API_KEY/g" {} \;

COPY ultrafastgrid/start.sh /
COPY package/ /

RUN filename=$(find applitools*.tgz) \
    && mv $filename home/project/tutorial-selenium-javascript-ultrafastgrid/$filename \
    && cd home/project/tutorial-selenium-javascript-ultrafastgrid \
    && npm install ./$filename \
    && npm install

CMD '/start.sh'
